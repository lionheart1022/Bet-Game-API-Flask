<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>BetGame Beta Testers Registration</title>
		<style>
label {
	display: block;
}
label input, label select {
	display: block;
}
label input[type=checkbox] {
	display: inline;
}
		</style>
		<script src="/scripts/jquery-1.11.3.min.js"></script>
		<script>
var API = {
	call: function(method, endpoint, data, success, failure) {
		return $.ajax({
			dataType: 'json',
			method: method,
			url: '/v1/'+endpoint,
			data: data,
			complete: function(xhr, stat) {
				var data = xhr.responseJSON;
				if(xhr.status >= 200 && xhr.status < 300) {
					if(success)
						success(data);
				} else {
					console.error('API error', stat, data)
					if(failure)
						failure(data, xhr.status);
				}
			},
		});
	},
};
$(function() {
	function addcb(container, val) {
		container.append('<label><input type="checkbox" data-value="'+val+'"/>'+val+'<'+'/label>');
	}
	function getcb(container) {
		var vals = [];
		$(container).find('input:checked').each(function(e) {
			vals.push($(this).data('value'));
		});
		return vals.join(',');
	}
	$.each([
			'Android',
			'iOS',
			'Windows Mobile',
			'Web',
			'other',
	], function(i, name) {
		addcb($('#platforms'), name);
	});
	API.call('GET', 'gametypes', {}, function(data) {
		$.each(data.gametypes, function(gametype,opts) {
			addcb($('#games'), gametype);
		});
	});

	$('#beta-form').submit(function(e) {
		e.preventDefault();
		$('.message').text('');

		var data = {
			email: $('[name=email]').val(),
			name: $('[name=name]').val(),
			platforms: getcb('#platforms'),
			games: getcb('#games'),
		};
		API.call('POST', 'beta', data, function() {
			$('#beta_form').slideUp();
			$('#success').slideDown();
		}, function(err) {
			$('.message').text(err.error || 'Unknown error');
		});
	});
});
		</script>
	</head>
	<body>
		<h1>BetGame Beta Testers Registration</h1>
		<p>Hello. If you want to try our exciting BetGame service, please register below
		and we will invite you once we enter beta testing stage.
		You can specify your desired platforms and games, this will allow us to manage efforts better.</p>
		<form id="beta_form" action="">
			<label>
				Your email address:
				<input name="email" type="email">
			</label>
			<label>
				Your name:
				<input name="name" type="text">
			</label>
			<p id="platforms">
				Please choose which platforms are you interested in:
				<label><input type="checkbox" name="platform_android"/>Android</label>
			</p>
			<p id="games">
				Please choose your desired games:
			</p>
			<input type="submit" value="Register"/>
			<div id="message" style="color: red;"></div>
		</form>
		<div id="success" style="display: none">
			Thanks for subscribing. We will notify you once beta testing will start.
		</div>
	</body>
</html>
